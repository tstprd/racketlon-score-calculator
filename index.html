<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="theme-color" content="#1a1a2e" />
    <title>Racketlon Calc</title>
    <script src="https://code.iconify.design/iconify-icon/2.0.0/iconify-icon.min.js"></script>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: #1a1a2e;
        color: #fff;
        min-height: 100vh;
        padding: 16px;
      }
      .container {
        max-width: 500px;
        margin: 0 auto;
      }
      header {
        text-align: center;
        margin-bottom: 20px;
      }
      header h1 {
        font-size: 1.5rem;
        margin-bottom: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
      }
      header h1 iconify-icon {
        font-size: 1.6rem;
      }
      header p {
        color: #888;
        font-size: 0.9rem;
      }
      .players-row {
        display: flex;
        gap: 12px;
        align-items: center;
        margin-bottom: 16px;
      }
      .player-input {
        flex: 1;
      }
      .player-input label {
        display: block;
        font-size: 0.75rem;
        color: #888;
        margin-bottom: 4px;
      }
      .player-input input {
        width: 100%;
        padding: 10px;
        border: 2px solid #0f3460;
        border-radius: 8px;
        background: #16213e;
        color: #fff;
        font-size: 1rem;
        text-align: center;
      }
      .player-input input:focus {
        outline: none;
        border-color: #e94560;
      }
      .vs {
        color: #e94560;
        font-weight: bold;
        padding-top: 18px;
      }
      .scores-grid {
        background: #16213e;
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 16px;
      }
      .sport-row {
        display: flex;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #0f3460;
      }
      .sport-row:last-child {
        border-bottom: none;
      }
      .sport-row.has-error .sport-name {
        color: #ff4757;
      }
      .sport-name {
        flex: 1;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .sport-name iconify-icon {
        font-size: 1.4rem;
        color: #e94560;
      }
      .score-group {
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .score-input {
        width: 50px;
        padding: 8px 4px;
        border: 2px solid #0f3460;
        border-radius: 8px;
        background: #1a1a2e;
        color: #fff;
        font-size: 1.1rem;
        text-align: center;
        -moz-appearance: textfield;
      }
      .score-input::-webkit-outer-spin-button,
      .score-input::-webkit-inner-spin-button {
        -webkit-appearance: none;
      }
      .score-input:focus {
        outline: none;
        border-color: #e94560;
      }
      .score-input.error {
        border-color: #ff4757 !important;
        background: rgba(255, 71, 87, 0.2);
      }
      .btn-21 {
        width: 36px;
        height: 36px;
        border: none;
        border-radius: 8px;
        background: #e94560;
        color: #fff;
        font-size: 0.85rem;
        font-weight: bold;
        cursor: pointer;
        -webkit-tap-highlight-color: transparent;
      }
      .btn-21:active {
        transform: scale(0.95);
        background: #ff6b6b;
      }
      .btn-x {
        width: 28px;
        height: 28px;
        border: 1px solid #444;
        border-radius: 6px;
        background: #2a2a4e;
        color: #888;
        font-size: 1rem;
        cursor: pointer;
        -webkit-tap-highlight-color: transparent;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }
      .btn-x:hover {
        color: #ff4757;
        border-color: #ff4757;
      }
      .btn-x:active {
        transform: scale(0.95);
        background: #ff4757;
        color: #fff;
      }
      .score-sep {
        margin: 0 8px;
        color: #888;
        font-weight: bold;
      }
      .total-row {
        display: flex;
        align-items: center;
        padding: 16px 0 8px;
        border-top: 2px solid #e94560;
        margin-top: 8px;
      }
      .total-row .sport-name {
        font-weight: bold;
      }
      .total-score {
        font-size: 1.3rem;
        font-weight: bold;
        color: #ff6b6b;
        min-width: 50px;
        text-align: center;
      }
      .delta-row {
        text-align: center;
        padding: 12px 0 4px;
        font-size: 0.95rem;
        font-weight: 600;
      }
      .delta-row.hidden {
        display: none;
      }
      .delta-positive {
        color: #00d26a;
      }
      .delta-negative {
        color: #e94560;
      }
      .delta-zero {
        color: #ffc107;
      }
      .errors-box {
        background: rgba(255, 71, 87, 0.15);
        border: 2px solid #ff4757;
        border-radius: 12px;
        padding: 12px;
        margin-bottom: 16px;
      }
      .errors-box h3 {
        color: #ff4757;
        font-size: 0.9rem;
        margin-bottom: 8px;
      }
      .errors-box ul {
        list-style: none;
        font-size: 0.85rem;
        color: #ff6b6b;
      }
      .errors-box li {
        padding: 4px 0;
      }
      .errors-box li::before {
        content: "‚ö†Ô∏è ";
      }
      .hidden {
        display: none !important;
      }
      .btn-clear {
        width: 100%;
        padding: 14px;
        border: 2px solid #888;
        border-radius: 12px;
        background: transparent;
        color: #888;
        font-size: 1rem;
        cursor: pointer;
        margin-bottom: 20px;
      }
      .btn-clear:active {
        border-color: #e94560;
        color: #e94560;
      }
      footer {
        text-align: center;
        padding: 20px 0;
        color: #888;
        font-size: 0.8rem;
      }
      footer a {
        color: #ff6b6b;
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>
          <iconify-icon icon="mdi:table-tennis"></iconify-icon
          ><iconify-icon icon="mdi:badminton"></iconify-icon
          ><iconify-icon icon="mdi:tennis"></iconify-icon> Racketlon Calc
        </h1>
        <p>Calculateur de scores v1.2</p>
      </header>
      <main>
        <div class="players-row">
          <div class="player-input">
            <label>Joueur A</label>
            <input type="text" id="playerA" placeholder="Nom" />
          </div>
          <div class="vs">VS</div>
          <div class="player-input">
            <label>Joueur B</label>
            <input type="text" id="playerB" placeholder="Nom" />
          </div>
        </div>
        <div class="scores-grid">
          <div class="sport-row" id="row-tt">
            <span class="sport-name"
              ><iconify-icon icon="mdi:table-tennis"></iconify-icon> Ping-pong</span
            >
            <div class="score-group">
              <button class="btn-x" onclick="clearCell('tt-a')">‚úï</button>
              <input
                type="number"
                class="score-input"
                id="tt-a"
                min="0"
                max="21"
                inputmode="numeric"
              />
              <button class="btn-21" onclick="set21('tt-a')">21</button>
            </div>
            <span class="score-sep">-</span>
            <div class="score-group">
              <button class="btn-x" onclick="clearCell('tt-b')">‚úï</button>
              <input
                type="number"
                class="score-input"
                id="tt-b"
                min="0"
                max="21"
                inputmode="numeric"
              />
              <button class="btn-21" onclick="set21('tt-b')">21</button>
            </div>
          </div>
          <div class="sport-row" id="row-bad">
            <span class="sport-name"
              ><iconify-icon icon="mdi:badminton"></iconify-icon> Badminton</span
            >
            <div class="score-group">
              <button class="btn-x" onclick="clearCell('bad-a')">‚úï</button>
              <input
                type="number"
                class="score-input"
                id="bad-a"
                min="0"
                max="21"
                inputmode="numeric"
              />
              <button class="btn-21" onclick="set21('bad-a')">21</button>
            </div>
            <span class="score-sep">-</span>
            <div class="score-group">
              <button class="btn-x" onclick="clearCell('bad-b')">‚úï</button>
              <input
                type="number"
                class="score-input"
                id="bad-b"
                min="0"
                max="21"
                inputmode="numeric"
              />
              <button class="btn-21" onclick="set21('bad-b')">21</button>
            </div>
          </div>
          <div class="sport-row" id="row-sq">
            <span class="sport-name"
              ><iconify-icon icon="mdi:racquetball"></iconify-icon> Squash</span
            >
            <div class="score-group">
              <button class="btn-x" onclick="clearCell('sq-a')">‚úï</button>
              <input
                type="number"
                class="score-input"
                id="sq-a"
                min="0"
                max="21"
                inputmode="numeric"
              />
              <button class="btn-21" onclick="set21('sq-a')">21</button>
            </div>
            <span class="score-sep">-</span>
            <div class="score-group">
              <button class="btn-x" onclick="clearCell('sq-b')">‚úï</button>
              <input
                type="number"
                class="score-input"
                id="sq-b"
                min="0"
                max="21"
                inputmode="numeric"
              />
              <button class="btn-21" onclick="set21('sq-b')">21</button>
            </div>
          </div>
          <div class="sport-row" id="row-ten">
            <span class="sport-name"><iconify-icon icon="mdi:tennis"></iconify-icon> Tennis</span>
            <div class="score-group">
              <button class="btn-x" onclick="clearCell('ten-a')">‚úï</button>
              <input
                type="number"
                class="score-input"
                id="ten-a"
                min="0"
                max="21"
                inputmode="numeric"
              />
              <button class="btn-21" onclick="set21('ten-a')">21</button>
            </div>
            <span class="score-sep">-</span>
            <div class="score-group">
              <button class="btn-x" onclick="clearCell('ten-b')">‚úï</button>
              <input
                type="number"
                class="score-input"
                id="ten-b"
                min="0"
                max="21"
                inputmode="numeric"
              />
              <button class="btn-21" onclick="set21('ten-b')">21</button>
            </div>
          </div>
          <div class="total-row">
            <span class="sport-name">üìä TOTAL</span>
            <span class="total-score" id="totalA">0</span>
            <span class="score-sep">-</span>
            <span class="total-score" id="totalB">0</span>
          </div>
          <div class="delta-row" id="deltaRow">
            <span id="deltaText"></span>
          </div>
        </div>
        <div id="errorsBox" class="errors-box hidden">
          <h3>‚ö†Ô∏è Scores invalides</h3>
          <ul id="errorsList"></ul>
        </div>
        <button class="btn-clear" onclick="clearAll()">üóëÔ∏è Effacer tout</button>
      </main>
      <footer>
        <p>Racketlon Calc ‚Ä¢ <a href="https://www.racketlon.net" target="_blank">R√®gles FIR</a></p>
      </footer>
    </div>
    <script>
      const SPORTS_CONFIG = [
        { id: "tt", name: "Ping-pong", row: "row-tt", key: "tabletennis" },
        { id: "bad", name: "Badminton", row: "row-bad", key: "badminton" },
        { id: "sq", name: "Squash", row: "row-sq", key: "squash" },
        { id: "ten", name: "Tennis", row: "row-ten", key: "tennis" },
      ];

      function set21(id) {
        document.getElementById(id).value = 21;
        update();
      }

      function clearCell(id) {
        document.getElementById(id).value = "";
        update();
      }

      function clearAll() {
        document.getElementById("playerA").value = "";
        document.getElementById("playerB").value = "";
        document.querySelectorAll(".score-input").forEach((i) => (i.value = ""));
        update();
      }

      function getScoreRaw(prefix) {
        const aEl = document.getElementById(prefix + "-a");
        const bEl = document.getElementById(prefix + "-b");
        return { a: aEl.value, b: bEl.value, aEl, bEl };
      }

      function validateScores() {
        const errors = [];
        let lastFilledIndex = -1;
        document.querySelectorAll(".score-input").forEach((el) => el.classList.remove("error"));
        document.querySelectorAll(".sport-row").forEach((el) => el.classList.remove("has-error"));

        SPORTS_CONFIG.forEach((sport, index) => {
          const { a, b, aEl, bEl } = getScoreRaw(sport.id);
          const aNum = parseInt(a),
            bNum = parseInt(b);
          const hasA = a !== "",
            hasB = b !== "";
          const hasBoth = hasA && hasB;

          if (hasBoth) {
            lastFilledIndex = index;
            if (aNum === 21 && bNum === 21) {
              errors.push({ sport: sport.name, msg: "Les deux ne peuvent pas avoir 21" });
              aEl.classList.add("error");
              bEl.classList.add("error");
              document.getElementById(sport.row).classList.add("has-error");
            } else if (aNum !== 21 && bNum !== 21) {
              errors.push({ sport: sport.name, msg: "Un joueur doit avoir 21" });
              aEl.classList.add("error");
              bEl.classList.add("error");
              document.getElementById(sport.row).classList.add("has-error");
            }
          } else if (hasA || hasB) {
            errors.push({ sport: sport.name, msg: "Score incomplet" });
            if (hasA) aEl.classList.add("error");
            if (hasB) bEl.classList.add("error");
            document.getElementById(sport.row).classList.add("has-error");
          }
        });

        let foundGap = false;
        SPORTS_CONFIG.forEach((sport, index) => {
          const { a, b } = getScoreRaw(sport.id);
          const hasBoth = a !== "" && b !== "";
          if (hasBoth && foundGap) {
            errors.push({ sport: sport.name, msg: "Remplir dans l'ordre" });
            document.getElementById(sport.row).classList.add("has-error");
          }
          if (!hasBoth && index < lastFilledIndex) foundGap = true;
        });

        return errors;
      }

      function update() {
        const errors = validateScores();
        const errorsBox = document.getElementById("errorsBox");
        const errorsList = document.getElementById("errorsList");

        if (errors.length > 0) {
          errorsList.innerHTML = errors
            .map((e) => `<li><strong>${e.sport}</strong>: ${e.msg}</li>`)
            .join("");
          errorsBox.classList.remove("hidden");
        } else {
          errorsBox.classList.add("hidden");
        }

        const scores = {};
        let totalA = 0,
          totalB = 0;

        SPORTS_CONFIG.forEach((sport) => {
          const { a, b } = getScoreRaw(sport.id);
          const aNum = parseInt(a),
            bNum = parseInt(b);
          if (
            a !== "" &&
            b !== "" &&
            (aNum === 21 || bNum === 21) &&
            !(aNum === 21 && bNum === 21)
          ) {
            scores[sport.key] = `${a}-${b}`;
            totalA += aNum;
            totalB += bNum;
          }
        });

        document.getElementById("totalA").textContent = totalA;
        document.getElementById("totalB").textContent = totalB;

        const playerA = document.getElementById("playerA").value || "Joueur A";
        const playerB = document.getElementById("playerB").value || "Joueur B";
        const delta = totalA - totalB;
        const deltaRow = document.getElementById("deltaRow");
        const deltaEl = document.getElementById("deltaText");

        if (totalA === 0 && totalB === 0) {
          deltaRow.classList.add("hidden");
        } else {
          deltaRow.classList.remove("hidden");
          if (delta > 0) {
            deltaEl.textContent = `${playerA} m√®ne de ${delta} pts`;
            deltaEl.className = "delta-positive";
          } else if (delta < 0) {
            deltaEl.textContent = `${playerB} m√®ne de ${Math.abs(delta)} pts`;
            deltaEl.className = "delta-negative";
          } else {
            deltaEl.textContent = "√âgalit√© parfaite";
            deltaEl.className = "delta-zero";
          }
        }

      }

      document.querySelectorAll(".score-input").forEach((input) => {
        input.addEventListener("input", () => {
          if (input.value > 21) input.value = 21;
          if (input.value < 0) input.value = 0;
          update();
        });
        input.addEventListener("focus", () => input.select());
      });

      document.getElementById("playerA").addEventListener("input", update);
      document.getElementById("playerB").addEventListener("input", update);

      update();
    </script>
  </body>
</html>
